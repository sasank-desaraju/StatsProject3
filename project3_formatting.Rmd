---
title: "Project 3"
author: "Sasank Desaraju, Phuc Pham, Natalie Geigel, Christopher Ludtka"
date: "11/18/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(car)
library(knitr)
library(emmeans)
library(tidymodels)

```

#Introduction: 

#A Priori: 

```{r copy-of-data-carpentry}
dataset <- readRDS("./data/group3_data.rds")

tidy_dataset <- dataset %>%
  rename(ID = record_id,
         Flanker_test = tb_flanker_unadj_ss,
         Pic_Seq_Mem_Test = tb_picseq_unadj_ss,
         Moca_Score = moca_unadj,
         Musical_Practice = champs_q17c,
         Age = gi_age,
         Education_Level = gi_degree,
         Second_Language = gi_2ndlang_yn,
         Track_Activity = pac_track_doing,
         Paying_Attention = pac_pay_attention,
         Concentration = pac_concentrate,
         Indecisiveness = bdi_indecisiveness,
         Remembering = pac_remember,
         R_Parahippo_vol = fs_parahpc_vol_r,
         L_Parahippo_vol = fs_parahpc_vol_l,
         Est_Tot_intra_cranial_vol = fs_etiv
         ) %>%
  mutate(Second_Language = if_else(condition = is.na(Second_Language), "No", "Yes")) %>%
  mutate(Musical_Practice = as_factor(Musical_Practice),
         Education_Level = as_factor(Education_Level),
         Second_Language = as_factor(Second_Language),
         Track_Activity = as_factor(Track_Activity),
         Paying_Attention = as_factor(Paying_Attention),
         Concentration = as_factor(Concentration),
         Indecisiveness = as_factor(Indecisiveness),
         Remembering = as_factor(Remembering),
         Moca_Score = as.numeric(Moca_Score),
         Age = as.numeric(Age))
         
Project3_theme <- function() {
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))
}
  
```

# Planned hypotheses

## Phuc stuff

# Scientific Hypotheses (Planned Analysis):

```{r planned-data-carpentry}
dataset <- readRDS("./data/group3_data.rds")

tidy_dataset <- dataset %>%
  rename(ID = record_id,
         Flanker_test = tb_flanker_unadj_ss,
         Pic_Seq_Mem_Test = tb_picseq_unadj_ss,
         Moca_Score = moca_unadj,
         Musical_Practice = champs_q17c,
         Age = gi_age,
         Education_Level = gi_degree,
         Second_Language = gi_2ndlang_yn,
         Track_Activity = pac_track_doing,
         Paying_Attention = pac_pay_attention,
         Concentration = pac_concentrate,
         Indecisiveness = bdi_indecisiveness,
         Remembering = pac_remember,
         R_Parahippo_vol = fs_parahpc_vol_r,
         L_Parahippo_vol = fs_parahpc_vol_l,
         Est_Tot_intra_cranial_vol = fs_etiv
         ) %>%
  mutate(Second_Language = if_else(condition = is.na(Second_Language), "No", "Yes")) %>% 
  mutate(Musical_Practice = if_else(condition = is.na(Musical_Practice), 0 , as.numeric(Musical_Practice))) %>% 
  mutate(Track_Activity = if_else(condition = is.na(Track_Activity), 0 , as.numeric(Track_Activity))) %>% 
  mutate(Remembering = if_else(condition = is.na(Remembering), 0 , as.numeric(Remembering))) %>%
  mutate(Musical_Practice = as_factor(Musical_Practice),
         Education_Level = as_factor(Education_Level),
         Second_Language = as_factor(Second_Language),
         Paying_Attention = as_factor(Paying_Attention),
         Track_Activity = as_factor(Track_Activity),
         Concentration = as_factor(Concentration),
         Indecisiveness = as_factor(Indecisiveness),
         Remembering = as_factor(Remembering),
         Moca_Score = as.numeric(Moca_Score),
         Age = as.numeric(Age)
  )
```

## Hypothesis 1:
The ability to keep track of current tasks, proxied by Flanker’s test of attention, can be explained by behavioral habits and a self-reported score when accounting for age and education level. These behavioral habits are ones that have been connected in literature to better brain performance: musical practice and fluency in multiple languages. The self-reported score asks the subject about their ability to keep track of current tasks in a distracting environment. 

* Variables from the dataset were renamed to improve clarity (Ex. tb_flanker_unadj_ss -> Flanker_test)

* Participants' responses on whether they spoke a second language contains NA (no) and the value one (yes). These responses were changed to No (NA) and yes   (one) in order to increase the number of data points for statistical analysis and was done under the assumption that the participants leaving no response   means that they did not speak a second language.

* Participants' responses on the degree in which they are able to track what they are doing even when interrupted (track activity) contains NA and a value   between the range of 1-5, with a higher value indicating a higher degree of being able to track current tasks. NA responses were changed to 0 under the    assumption that NA indicates the Participants' inability to track current tasks for the purpose of increasing data points and homogeneity with external    variables.

```{r}
hypo_one_dataset <- tidy_dataset %>%
  select(ID,
         Flanker_test,
         Age,
         Musical_Practice,
         Second_Language,
         Education_Level,
         Track_Activity
  )
  
```
### Statistical Hypothesis:

Ho: Flanker’s test scores will not be significantly different for different behavioral habits, accounting for age and education. 

Ha: Flanker’s test scores will be significantly different for different behavioral 	habits, accounting for age and education. 

### Statistical Model:
$$\begin{aligned}
\hat{y}_{Flanker.Test} = \beta_{Age}X_{Age}? + \beta_{Music}X_{Music}? +
\beta_{Language}X_{Language}? + \beta_{Education}X_{Education}? + \beta_{Track}X_{Track}?
\end{aligned}$$

### Visualization:
```{r}
#Age vs. Flanker's Test
ggplot(data = hypo_one_dataset, aes(x = Age,
                                    y = Flanker_test)) +
  geom_point() +
  geom_smooth(method = lm, formula = `y` ~ `x`, se = F) +
  xlab("Age") +
  ylab("Flanker's Test Unadjusted Score") + 
  labs(title = "Age vs. Flanker's Test") + 
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Age vs. Flanker's Test): There is a negative correlation between the participants' age and unadjusted scores from Flanker's test. The linear regression overlayed over the scatterplot suggests that the relationship between the two variables are not strong, as points are spread out along the y-axis.}

```{r}
#Musical Practice vs. Flanker's Test
ggplot(data = hypo_one_dataset, aes(x = Musical_Practice, y = Flanker_test,
                                    color = Musical_Practice)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  xlab("Musical Practice (Total Hrs per Week)") +
  ylab("Flanker's Test Unadjusted Score")  + 
  labs(title = "Musical Practice vs. Flanker's Test") + 
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Musical vs. Flanker's Test): The boxplot suggests that there is not a significant relationship and variation between the participants' unadjusted scores from the Flanker's test and how many hours per week they conducted musical practice. This can be visually observed through each group's mean being similar in position to each on the y-axis and following no trend.}

```{r}
#Second Language vs. Flanker's Test
ggplot(data = hypo_one_dataset, aes(x = Second_Language, y = Flanker_test,
                                    color = Second_Language)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "green") +
  geom_dotplot(binaxis = "y",stackdir = "center", binwidth = 0.8) +
  xlab("Second Language(s)") +
  ylab("Flanker's Test Unadjusted Score")  + 
  labs(title = "Second Language(s) vs. Flanker's Test") + 
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Second Language Speaking vs. Flanker's Test): The boxplot shows that there is some impact of speaking a second language on participants' unadjusted Flanker's test scores. The boxplot that represents speaking a second language has a mean and overall quartile score values higher than the boxplot that represents not speaking a second language.}

```{r}
#Education Level vs. Flanker's Test
ggplot(data = hypo_one_dataset, aes(x = Education_Level, y = Flanker_test,
                                    color = Education_Level)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  xlab("Highest Academic Degree") +
  ylab("Flanker's Test Unadjusted Score")  + 
  labs(title = "Highest Academic Degree vs. Flanker's Test") + 
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Highest Academic Degree vs. Flanker's Test): The boxplots can be visually observed to suggest that the degree of education do not have a significant effect on the unadjusted Flanker's test scores of participants. Specifically, the means of each boxplot are relatively similar and do not deviate much from each other.}

```{r}
#Keep Track of Current Tasks vs. Flanker's Test
ggplot(data = hypo_one_dataset, aes(x = Track_Activity, y = Flanker_test,
                                    color = Track_Activity)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  xlab("Keep Track of Current Tasks") +
  ylab("Flanker's Test Unadjusted Score")  + 
  labs(title = "Keep Track of Current Tasks vs. Flanker's Test") + 
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Keep Track of Current Tasks vs. Flanker's Test): The boxplot can be visually observed to suggest that there is not a significant effect between the ability to keep track of current tasks and the unadjusted Flanker's test scores of participants. Specifically, the mean of each boxplot do not follow a trend with increasing degree in ability to keep track of current tasks.} 

## Model Interpretation and Analysis:

\textbf{Model 1 (Full Model): Anova (type 2) test}
* The terms of: Track Activity, Second Language, Education Level, and Musical Practice are insignificant (p-value >> alpha = 0.05).
* The terms of: Age is significant (p-value << alpha = 0.05).
* A large degree of the model's variance is attributed to the age variable.
* Only the participants' age can be conclusively determined to have a significant effect on the participants' unadjusted Flanker's test scores. 

```{r}
#Model Construction
hypo1_model_1 <- lm(data = hypo_one_dataset, Flanker_test ~ Track_Activity + Age + Second_Language + Education_Level + Musical_Practice)

#Analysis and Comparison
kable(tidy(hypo1_model_1), digits = 3)
kable(tidy(Anova(hypo1_model_1, type = 2, alpha = 0.05)), digits = 3)
```
Model 2 (Age & Education Removed): Anova (type 2) test
* The terms of: Track Activity, Second Language, and Musical Practice are insignificant (p-value >> alpha = 0.05).
* No significant terms are contained in the model.
* A large degree of the model's variance is attributed to the track activity variable.

```{r}
#Model Construction
hypo1_model_2 <- lm(data = hypo_one_dataset, Flanker_test ~ Track_Activity + Second_Language + Musical_Practice)

#Analysis and Comparison
kable(tidy(hypo1_model_2), digits = 3)
kable(tidy(Anova(hypo1_model_2, type = 2, alpha = 0.05)), digits = 3)
```
### Model 3 (Age & Education Removed): \emph{Anova (type 2) test}
* The terms of: Track Activity, Second Language, and Musical Practice are insignificant (p-value >> alpha = 0.05).
* No significant terms are contained in the model.
* A large degree of the model's variance is attributed to the track activity variable.

* The full model (model 1) has the lowest AIC score; therefore it is conclusive to state it as the best model thus far. 
```{r}
#Model Construction
hypo1_model_3 <- lm(data = hypo_one_dataset, Flanker_test ~ Age + Education_Level)

#Analysis and Comparison
kable(tidy(hypo1_model_3), digits = 3)
kable(tidy(Anova(hypo1_model_3, type = 2, alpha = 0.05)), digits = 3)
kable(AIC(hypo1_model_1, hypo1_model_2, hypo1_model_3))
```


```{r}
# Plot the std. residuals against the fitted values.
ggplot(hypo1_model_3_aug, aes(.fitted, .std.resid))+
  geom_point()+
  #geom_smooth(method = loess, formula = `y` ~ `x`, se = F)+
  geom_smooth(method=lm, formula = `y` ~ `x`)+
  geom_hline(yintercept = c(-2, 2), linetype=2, size=0.5)+
  labs(title = "Residuals vs. Fitted Values for Hypothesis One")+
  theme(plot.title = element_text(size = rel(1),
                                hjust = 0.5))
```
\textbf{Residuals vs. Fitted Values Plot:}
* Inspecting the plot, the residuals appear to be randomly distributed around the 0 line, indicating it is reasonable to assume a linear relationship. They form a rough band around the 0 line, indicating the error term variances are approximately equal. One residual in particular stands out somewhat in the upper right corner of the plot, potentially representing an outlier.


```{r}
# QQ Plot
ggplot(hypo1_model_3_aug, aes(sample=.std.resid))+
  stat_qq(aes(color = "red"), show.legend = F)+
  stat_qq_line(aes(color = "blue"), show.legend = F) +
  labs(title = "QQ Plot showing Distribution of Standard
Residual Values for Hypothesis One") +
ylab("Sample") +
xlab("Theoretical") + 
theme(plot.title = element_text(size = rel(1),
                                hjust = 0.5))

hat_avg_model_3 = (2+1)/nrow(hypo1_model_3_aug) 
```
\textbf{QQ Plot:}
* Observing the QQ plot shows that the model most closely follows a Chi-squared distribution with the left and right hand tails tilting upwards. However, there is variation as the points at the tails are scewing away from the linear line.

```{r}
#Cooks Distance:
hypo1_model_3_aug %>% 
  ggplot( aes(.hat, .std.resid, size=.cooksd))+
  geom_point(shape = 1)+
  geom_vline(xintercept = hat_avg_model_3, linetype = 2)+
  geom_vline(xintercept = 2 * hat_avg_model_3, linetype = 2, color="orange")+
  geom_vline(xintercept = 3 * hat_avg_model_3, linetype = 2, color="red")+
  geom_hline(yintercept = c(-2, 2), linetype = 2)+
    geom_text(aes(label=if_else(.cooksd>=(3 * mean(.cooksd)),
                              paste0("(",Education_Level, ", ", Flanker_test, ")"), "")), nudge_y = 0.2, nudge_x = 0.005, size=2.5)+
  labs(title = "Cooks Distance for Hypothesis One Model")+
  theme_bw() +
  theme(plot.title = element_text(size = rel(1), hjust = 0.5)) 
  
```
\textbf{Cooks Distance Plot: }
* Using the general rule of thumb for highlighting outliers of 3*(average Cooks Distance), we do not see any points that pass that threshold. Visually inspecting the graph, while numerous points have high leverage, there are not any points with notably inordinate influence (as represented by Cooks Distance) relative to the bulk of other data points. For these reasons, we did not identify and remove any outliers from this dataset.

### Discussion:


## Chris stuff

## Hypothesis 2: 
The ability to recall from memory, proxied by the NIH Picture Sequence Memory Test, can be explained by the combined effect of relevant behavioral habits, fractional brain volume of a relevant section of the brain, and a self-reported score when accounting for age and education. These behavioral habits are ones that have been connected in literature to better brain performance: musical practice and fluency in multiple languages. The brain volume considered is the parahippocampal region, known in literature to be important for memory function. The self-reported score asks the subject about their ability to easily recall details in their day-to-day lives. 

* Variables from the dataset have been renamed to improve clarity (e.g. tb_picseq_unadj_ss -> Pic_Seq_Mem_Test)

* Participants' responses on whether they spoke a second language contains 'NA' (no) and the value '1' (yes). These responses were changed to No ('NA') and yes ('1') in order to increase the number of data points for statistical analysis and was done under the assumption that the participants leaving no response meant that they did not speak a second language. Without this assumption, an analysis could not be made, as it would represent a factor with only a single factor level.

* Participants' responses on the degree in which they are able to remember this as easily as usual (pac_remember -> Remembering) contains NAs and values between 1 and 5, with a higher number representing of greater agreement that their ability to remember things as easily as usual. NA responses were changed to '0' to represent the portion of patients who did not answer the question as their own factor level. Unfortunately without doing so, the patchiness of the dataset (i.e. missing values across different categories) prevented the creation of a linear model due to insufficient data points. In short, an insufficient number of patients answered every single question evaluated within our model.

```{r}
hypo_two_dataset <- tidy_dataset %>%
  select(ID,
         Pic_Seq_Mem_Test,
         Age,
         Musical_Practice,
         R_Parahippo_vol,
         L_Parahippo_vol,
         Est_Tot_intra_cranial_vol,
         Second_Language,
         Education_Level,
         Remembering
  ) %>% 
  mutate(Parahippo_vol = 
           (R_Parahippo_vol + L_Parahippo_vol) / Est_Tot_intra_cranial_vol)
# Fractional parahippocampal volume (Parahippo_vol) is calculated as the sum of the left and right parahippocampal volumes as a fraction of the estimated total intracranial volume:
# (Parahippo_vol = (fs_parahpc_vol_l + fs_parahpc_vol_r) / (fs_etiv)) 

```
### Statistical Hypothesis:

Ho: The NIH Picture Sequence Memory test scores will not be significantly different for different behavioral habits and brain volumes, accounting for age and education. 

Ha: NIH Picture Sequence Memory test scores will be significantly different for different behavioral habits and brain volumes, accounting for age and education. 

### Statistical Model:
$$\begin{aligned}
\hat{y}_{Pic.Seq.Mem.} = \beta_{Age}X_{Age}? + \beta_{Music}X_{Music}? +
\beta_{Language}X_{Language}? + \beta_{Education}X_{Education}? + \beta_{PHC}X_{PHC}? + \beta_{Remembering}X_{Remembering}?
\end{aligned}$$

### Visualization:
```{r}
#Age vs. Picture Sequence Memory Test
ggplot(data = hypo_two_dataset, aes(x = Age,
                                    y = Pic_Seq_Mem_Test)) +
  geom_point() +
  geom_smooth(method = lm, formula = `y` ~ `x`, se = F) +
  ylab("Picture Sequence Memory Test Score") +
  labs(title = "Age vs. Picture Sequence Memory Test") +
  theme_bw() +
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Age vs. Picture Sequence Memory Test): There is a negative correlation between the participants' age and scores from the Picture Sequence Memory test. This may indicate that memory associated with picture sequencing diminishes with age.}

```{r}
#Musical Practice vs. Picture Sequence Memory Test
ggplot(data = hypo_two_dataset %>% filter(!is.na(Musical_Practice)), aes(x = Musical_Practice, y = Pic_Seq_Mem_Test,                                 color=factor(Musical_Practice,labels=c("Blank","<1 hr","1-2.5 hr","3-4.5 hr","5-6.5 hr")))) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  scale_x_discrete(labels=c("Blank","<1 hr","1-2.5 hr","3-4.5 hr","5-6.5 hr")) +
  xlab("Musical Practice") +
  ylab("Picture Sequence Memory Test Score") +
  labs(color='Musical Practice') +
  labs(title = "Musical Practice vs. Picture Sequence Memory Test") +
  theme_bw() +
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Musical Practice vs. Picture Sequence Memory Test): The boxplot does not appear to suggest that there is a significant effect between musical practice and the Picture Sequence Memory test scores of participants. Specifically, the means of each boxplot does not appear to follow a trend with increasing score in the Picture Sequence Memory Test. It is also important to note that there are relatively few data points, as no answer is given for this particular question for many of the participants in the provided dataset, and very few participants answered for the higher categories of number of hours practiced.} 

```{r}
#Second Language vs. Picture Sequence Memory Test
ggplot(data = hypo_two_dataset %>% filter(!is.na(Second_Language)), aes(x = Second_Language, y = Pic_Seq_Mem_Test,
                                    color = Second_Language)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "green") +
  geom_dotplot(binaxis = "y",stackdir = "center", binwidth = 0.8) +
  xlab("Second Language") +
  ylab("Picture Sequence Memory Test Score") +
  labs(title = "Second Language vs. Picture Sequence Memory Test") +
  theme_bw() +
  Project3_theme()
```
\emph{Figure (Second Language vs. Picture Sequence Memory Test): The boxplot appears to suggest that there is a significant effect between speaking a second language and the Picture Sequence Memory test scores of participants. Specifically, the means of each boxplot are notably different. It is also important to note however that there are relatively few data points in the 'Yes' group.}

```{r}
#Education Level vs. Picture Sequence Memory Test
ggplot(data = hypo_two_dataset %>% filter(!is.na(Education_Level)), aes(x = Education_Level, y = Pic_Seq_Mem_Test,
                                    color = Education_Level)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  scale_x_discrete(labels=c("High School","Associate's","Bachelor's","Master's","Doctorate/Professional")) +
  xlab("Education Level") +
  ylab("Picture Sequence Memory Test Score") +
  labs(title = "Education Level vs. Picture Sequence Memory Test") +
  theme_bw() +
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Education Level vs. Picture Sequence Memory Test): The boxplot does not appear to suggest that there is a significant effect between education level and the Picture Sequence Memory test scores of participants. Specifically, the means of each boxplot do not appear to follow a trend with increasing score in the Picture Sequence Memory Test.}

```{r}
#Parahippocampal Volume vs. Picture Sequence Memory Test
ggplot(data = hypo_two_dataset, aes(x = Parahippo_vol,
                                    y = Pic_Seq_Mem_Test)) +
  geom_point() +
  geom_smooth(method = lm, formula = `y` ~ `x`, se = F) + 
  xlab("Parahippocampal Volume") +
  ylab("Picture Sequence Memory Test Score") +
  labs(title = "Parahippocampal Volume vs. Picture Sequence Memory Test") +
  theme_bw() +
  theme(plot.title = element_text(size = rel(1.2), hjust = 0.5))
```
\emph{Figure (Parahippocampal Volume vs. Picture Sequence Memory Test): There is a positive correlation between the participants' fractional parahippocampal volume and scores from the Picture Sequence Memory test. This may indicate that greater fractional volume of the parahippocampus region represents a better memory ability for picture sequencing.}

```{r}
#Ability to Remember vs. Picture Sequence Memory Test
ggplot(drop_na(hypo_two_dataset,Remembering,Pic_Seq_Mem_Test), aes(x = Remembering, y = Pic_Seq_Mem_Test,
                                    color = Remembering)) +
  geom_boxplot(show.legend = FALSE) +
  stat_summary(fun.data = mean_se, color = "black") +
  scale_x_discrete(labels=c("Not Answered","A little bit","Somewhat","Quite a bit","Very much")) +
  xlab("Ability to Remember Things as Easily as Usual") +
  ylab("Picture Sequence Memory Test Score") +
  labs(title = "Ability to Remember Things as Easily as Usual\n vs. Picture Sequence Memory Test")+
  theme_bw()+
  Project3_theme()
```
\emph{Figure (Ability to Remember vs. Picture Sequence Memory Test): The boxplot does not appear to suggest that there is a significant effect between the ability to remember things and the Picture Sequence Memory test scores of participants. Specifically, the means of each boxplot do not appear to follow a trend with increasing score in the Picture Sequence Memory Test. It is also important to note that there are relatively few data points, as no answer is given for this particular question for many of the participants in the provided dataset.}

### Model Interpretation and Analysis:
```{r}
# Original Hypothesis Two model generation
hypo2_model <- lm(data = hypo_two_dataset, formula = Pic_Seq_Mem_Test ~ Age + Education_Level + Musical_Practice + Second_Language + Parahippo_vol + Remembering)
kable(tidy(hypo2_model), digits = 3)
kable(tidy(Anova(hypo2_model, type = 2, alpha = 0.05)), digits = 3)
```
Model 1 (Full Model): Anova (type 2) test
* The terms of: Education Level, Musical Practice, and Remembering are insignificant (p-value >> alpha = 0.05).
* The terms of: Age, Second Language, and Parahippocampal Volume are significant (p-value << alpha = 0.05).
* A large degree of the model's variance is attributed to the Age variable.

```{r}
# Create alternative model with non statistically significant variables removed from model, for comparison with original model
hypo2_model_2 <- lm(data = hypo_two_dataset, formula = Pic_Seq_Mem_Test ~ Age + Second_Language + Parahippo_vol )
kable(tidy(hypo2_model_2), digits = 3)
kable(tidy(Anova(hypo2_model_2, type = 2, alpha = 0.05)), digits = 3)

# Compare original and alternative models
kable(AIC(hypo2_model, hypo2_model_2))
```
Model 2 (Education Level, Musical Practice, and Remembering): Anova (type 2) test
* The Parahippocampal Volume term is now insignificant (p-value >> alpha = 0.05).
* The Age and Second Language terms remain significant in this new model.
* A large degree of the model's variance is attributed to both Age and Second Language variables, with Parahippocampal volume representing much less.

The original model has lower AIC value, therefore is a 'better' model according to this measure.

```{r}
# Model diagnostics plotting
hypo2_model_aug <- augment(hypo2_model)

# Hypothesis Two Residuals vs. Fitted Values plot
ggplot(hypo2_model_aug, aes(.fitted, .resid)) +
  geom_point() +  
  geom_smooth(method=lm, formula = `y` ~ `x`) +
  labs(
title = "Residuals vs. Fitted Values for Hypothesis Two")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))
```
Residuals vs. Fitted Values Plot:
* Inspecting the plot, the residuals appear to be randomly distributed around the 0 line, indicating it is reasonable to assume a linear relationship. They form a rough band around the 0 line, indicating the error term variances are approximately equal. One residual in particular stands out somewhat in the upper right corner of the plot, potentially representing an outlier.

```{r}
#Hypothesis Two QQ plot
hypo2_model_aug %>%
    ggplot(aes(sample= .std.resid)) +
  stat_qq() +
  stat_qq_line() +
  labs(
title = "QQ Plot showing Distribution of Standard
Residual Values for Hypothesis Two") +
ylab("Sample") +
xlab("Theoretical") +
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))
```
QQ Plot:
* Observing the QQ plot shows that the model most closely follows a chi squared distribution with both the left hand and right hand tails tilting up.

```{r}
#Hypothesis Two Cooks Distance plot
hypo2_model_ave_hat = (6+1)/nrow(hypo2_model_aug)
#hat_ave = (k+1)/n
    #k = number of regressors, = 6 here
    #n = number of samples

hypo2_model_aug %>% 
  ggplot( aes( y = .std.resid,
               x = .hat, size = .cooksd )) +
  geom_point(shape = 1) +
  geom_vline(xintercept = hypo2_model_ave_hat, 
             linetype = 2) +
  geom_vline(xintercept = 2 *	hypo2_model_ave_hat,
             linetype = 2, color="orange") +
  geom_vline(xintercept = 3 * hypo2_model_ave_hat,
             linetype = 2, color="red") +
  geom_text(aes(label=if_else(.cooksd>=(3 * mean(.cooksd)),
                              # 3*(average Cooks Distance) is a general rule of thumb for highlighting potential outliers
                              str_c("(", `Pic_Seq_Mem_Test`, ", ", `Parahippo_vol`,")"), "")),
            nudge_y = 0.2, size=3, nudge_x = 0.035, color = "red") +
  labs(
    title = "Cooks Distance for Hypothesis 2 Model")+
  
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))
```
\emph{Cooks Distance Plot:} 
* Using the general rule of thumb for highlighting outliers of 3*(average Cooks Distance), we do not see any points that pass that threshold. Visually inspecting the graph, while numerous points have high leverage, there are not any points with notably inordinate influence (as represented by Cooks Distance) relative to the bulk of other data points. For these reasons, we did not identify and remove any outliers from this dataset.

```{r}
#Post-hoc

hypo2_emm <- emmeans(hypo2_model, ~ Age | Education_Level | Musical_Practice | Second_Language | Parahippo_vol | Remembering)

contrast(hypo2_emm, by = NULL) %>%
  tidy()
# TODO: clean up output or delete

```

# Exploratory analysis

## Natalie stuff
# Exploratory Analyses: 
## Question 1
Are Moca scores impacted by different symptoms of Mild Cognitive Impairment, such as ability to pay attention, concentrate, remember things, and indecisiveness? Analysis will be done on various self reported scores to see if a relationship exists.

\textbf{Self-reported Score Meanings:}

* Paying Attention: lower numbers indicate difficulty paying attention and keeping track of tasks while higher numbers indicate high ability to pay attention. The range goes from 1-5. 

* Remembering: lower numbers indicate difficulty remembering things while higher numbers indicate things are easy to remember.The range goes from 1-5. 

* Concentration: lower numbers indicate difficulty concentrating while higher numbers indicate concentration is as easy as usual. The range goes from 1-5. 

* Indecisiveness: lower numbers indicate decisions have been as easy to make as normal and higher numbers indicate high indecisiveness. It scales from 0-3.

```{r exploratory-data-carpentry,echo = FALSE}
exp_dataset <- tidy_dataset %>%
  filter(redcap_event_name == "event_1_arm_1") %>%
  select(-redcap_event_name) 
# Y (MoCA Score) ~ fct1 (pac_pay_attention) + fct2 (pac_remember) + fct3 (bdi_indecisiveness) + fct4(pac_concentrate) 

  Colorcols <- c("1" = "#D5DCE8", "2" = "#A9C3E5", "3" = "#1F94E6", "4" = "#3569AC","5" = "#0029AE")
  Colorcols2 <-c("0" = "#D5DCE8", "1" = "#A9C3E5", "2" = "#1F94E6","3" = "#3569AC")

#Model 2: understanding factors as related to cognitive impairment compared to moca scores

ggplot(drop_na(exp_dataset,Paying_Attention, Moca_Score), aes(Paying_Attention,Moca_Score,color = Paying_Attention))+
  #scale_color_manual(values = Colorcols)+
  geom_boxplot()+
  geom_jitter(alpha=0.5, height = 0)+
  ggtitle("Moca Scores vs Attention")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(exp_dataset,Remembering, Moca_Score), aes(Remembering,Moca_Score,color = Remembering))+
  #scale_color_manual(values = Colorcols)+
  geom_boxplot()+
  geom_jitter(alpha=0.5, height = 0)+
  ggtitle("Moca Scores vs Memory")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(exp_dataset,Indecisiveness, Moca_Score), aes(Indecisiveness,Moca_Score,color = Indecisiveness))+
  #scale_color_manual(values = Colorcols2)+
  geom_boxplot()+
  geom_jitter(alpha=0.5, height = 0)+
  ggtitle("Moca Scores vs Indecisiveness")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(exp_dataset,Concentration, Moca_Score), aes(Concentration,Moca_Score,color = Concentration))+
  #scale_color_manual(values = Colorcols)+
  geom_boxplot()+
  geom_jitter(alpha=0.5, height = 0)+
  ggtitle("Moca Scores vs Concentration")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

```

### \emph{Question 1 Figure Observations:}
In all 4 of these figures, it is evident there is not a lot of data available. Many of the self-reported scores were simply left blank. This is likely to  greatly impact the model created. General observations from the figures would indicate higher ability to concentrate and remember result in higher Moca Scores in the normal range above 25, with lower concentration and memory below 25 implying potential cognitive impairment. Still, a model needs to be created and tested to see if there is a relationship at all.


```{r pressure, echo=FALSE}
# If I drop NA's from every column, the result is only 27 observations which is concerning. It gets rid of indecisive scores of 2
MoCA_dropna <- exp_dataset %>%
  select(Paying_Attention,Remembering,Indecisiveness,Concentration,Moca_Score)  
# %>%
#   drop_na(Paying_Attention,Remembering,Indecisiveness,Concentration)
# Y (MoCA Score) ~ fct1 (pac_pay_attention) + fct2 (pac_remember) + fct3 (bdi_indecisiveness) + fct4(pac_concentrate) 

Mocamod <- lm(MoCA_dropna,
              formula = Moca_Score ~ Paying_Attention + Remembering + Indecisiveness + Concentration)
kable(glance(Mocamod))
kable(Anova(Mocamod))
kable(tidy(Mocamod))

```
### \emph{Model 1 Interpretation:}
Due to all the missing values, only 27 observations ended up contributing to the model itself. The only category that had any statistical significance according to the Anova was paying attention, indicating that the one of the means for paying attention may be statistically different. When looking at the t-test, however, none of the coefficients are significant so this model cannot be used to make any real conclusions. It is important to note that the lack of objectiveness in self-reported scores would have led to questions about the validity of conclusions if there had not also been a lack of responses. This leads to expanding to further exploration using objective, numerical scores from Flanker's test (testing attention and concentration) and the Picture Sequence Memory Test (testing episodic memory) and their relationship to Moca Scores. This analysis will be shown later in the report.


# Expanded Exploratory Analyses: 
## Question 1 continued
It would still be interesting to understand if different scores for memory, attention and concentration, which are impacted by Mild Cognitive Impairment (MCI), have an impact on Moca scores. This time, we will use Flanker's Test and the Picture Sequence Memory Test to see if these factors have an impact on Moca scores, which can implicate MCI if the score is below 25. However, Age can also be a confounding factor on memory and attention and potentially Moca scores as well, so it will be included in this model.

```{r exploratory-data-carpentry-expansion,echo = FALSE}

#Model 1 Expanded: understanding factors as related to cognitive impairment compared to moca scores

Moca_unplanned <- exp_dataset %>%
  select(ID,Flanker_test,Pic_Seq_Mem_Test,Moca_Score,Age) 

ggplot(drop_na(Moca_unplanned,Age,Moca_Score), aes(Age,Moca_Score))+
  geom_point()+
  geom_smooth(method = lm, formula = y~x)+
  ggtitle("Moca Scores vs Age")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(Moca_unplanned,Flanker_test, Moca_Score), aes(Flanker_test,Moca_Score))+
  geom_point()+
  geom_smooth(method = lm, formula = y~x)+
  ggtitle("Flanker's Test vs Moca Scores")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(Moca_unplanned,Pic_Seq_Mem_Test, Moca_Score), aes(Pic_Seq_Mem_Test,Moca_Score))+
  geom_point()+
  geom_smooth(method = lm, formula = y~x)+
  ggtitle("Picture Memory Test vs Moca Scores")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(Moca_unplanned,Pic_Seq_Mem_Test, Age), aes(Age,Pic_Seq_Mem_Test))+
  geom_point()+
  geom_smooth(method = lm, formula = y~x)+
  ggtitle("Age vs Memory Scores")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))

ggplot(drop_na(Moca_unplanned,Flanker_test, Age), aes(Age,Flanker_test))+
  geom_point()+
  geom_smooth(method = lm, formula = y~x)+
  ggtitle("Age vs Flanker's Test")+
  theme_bw()+
  theme(axis.line = element_line(size=0.7, colour="#0006FD"),
        axis.ticks = element_line(size = 0.6, colour="#0006FD"),       
        axis.title.x= element_text(colour="#0029AE",size=14),
        axis.title.y= element_text(colour="#0029AE",size=14),
        axis.text.x = element_text(colour="#3F918B",size=12),
        axis.text.y = element_text(colour="#3F918B",size=12),
        strip.text.x = element_text(colour = "white", face = "bold"),
        strip.text.y = element_text(colour = "white", face = "bold"),
        strip.background = element_rect(colour = "#0029AE", fill = "#0029AE"),
        plot.title = element_text(hjust = 0.5))



```

### \emph{Expanded Analysis Question 1 Figure Observations:}
In each figure, there seems to be general trends visible. Moca scores appear to decrease with age and increase with higher Flanker's and Picture Sequence Memory Tests. Flanker's Test and Picture Sequence Memory Test scores both decrease with increasing age, indicating that we should check for interactions in the model analyses or if it can be left out since every score decreases with age.

```{r Moca Unplanned Models, echo = FALSE}
#No age
Moca_unplanned_mod <- lm(Moca_unplanned,
                         formula = Moca_Score ~ Flanker_test + Pic_Seq_Mem_Test)
kable(Anova(Moca_unplanned_mod))
kable(tidy(Moca_unplanned_mod))
kable(glance(Moca_unplanned_mod))


```

### \emph{Model Excluding Age Interpretation:}
This model shows Flanker's Test scores, which are proxy for attention, to insignificantly affect Moca Scores according to the Anova table. The Picture Sequence Memory Test, however, does show a significant impact in predicting Moca scores. Increased memory test scores correlate with increased moca scores, which makes sense as better memory and higher moca scores implies normal cognition as opposed to impaired cognition.


```{r Age Mod, echo=FALSE}
#Age Model, No interactions
Moca_unplanned_agemod <- lm(Moca_unplanned,
                         formula = Moca_Score ~ Age + Flanker_test + Pic_Seq_Mem_Test)
kable(Anova(Moca_unplanned_agemod))
kable(tidy(Moca_unplanned_agemod))
kable(glance(Moca_unplanned_agemod))

```
### \emph{Model Including Age Interpretation:}
This model includes age to see if it also factors into predicting moca scores. According to the Anova table, neither Age nor Flanker's test scores significantly affect or change with Moca scores. As with the previous model, it shows the Picture Sequence Memory test scores increase with Moca scores.


```{r Age Interactions Mod,echo=FALSE}
#Age Model, Interactions
Moca_unplanned_ageintmod <- lm(Moca_unplanned,
                         formula = Moca_Score ~ Age + Flanker_test + 
                           Pic_Seq_Mem_Test + Age:Flanker_test + Age:Pic_Seq_Mem_Test)
kable(Anova(Moca_unplanned_ageintmod))
kable(tidy(Moca_unplanned_ageintmod))
kable(glance(Moca_unplanned_ageintmod))

```
### \emph{Moca Model Including Age and Interactions Interpretation:}
This model includes interactions with age to see if it also factors into predicting moca scores. According to the Anova table, age does not interact with the other predictors and actually renders the one significant lower order relative insignificant as well.

```{r Compare Mod,echo=FALSE}

kable(AIC(Moca_unplanned_mod,Moca_unplanned_agemod,Moca_unplanned_ageintmod))
```

### \emph{Moca Model Comparisons:}
All of the models have similar AIC values, however, the one with the lowest AIC is the model that excluded age. This model will be used to base the conclusions on. Given that, we will use that model moving forward to inspect for normally distributed residuals and check for outliers.

```{r}
Moca_unplanned_aug <- augment(Moca_unplanned_mod)
ggplot(Moca_unplanned_aug, aes(sample=.std.resid))+
  stat_qq()+
  stat_qq_line(color = "orange")+
  ggtitle("Inspecting Residuals of Model")+
  theme_bw()+
  Project3_theme()



```

### \emph{Residual Inspection Interpretation:}
Based on the qq plot above, the residuals appear normally distributed and we can proceed with the linear model created.

```{r}
rownumMoca <- nrow(Moca_unplanned_aug)
avg_hatMoca = (1+2)/rownumMoca

Moca_unplanned_aug %>%
  ggplot( aes(.hat, .std.resid, size=.cooksd))+
  geom_point(shape = 1)+
  geom_vline(xintercept = avg_hatMoca, linetype = 2)+
  geom_vline(xintercept = 2 * avg_hatMoca, linetype = 2, color="orange")+
  geom_vline(xintercept = 3 * avg_hatMoca, linetype = 2, color="red")+
  geom_hline(yintercept = c(-2, 2), linetype = 2)+
  geom_text(aes(label=if_else(.cooksd>=(3 * mean(.cooksd)) | .hat >=3 * avg_hatMoca, paste0("(", Flanker_test, ", ", Moca_Score,")"),'')),  nudge_y = 0.2, size=3)+
  theme_bw()+
  Project3_theme()
```

## Parahippocampal Volume and Memory

*Planned exploratory analysis*

### Data Visualization

### Initial Model Analysis

### Residual and Outlier Analysis

### Subsequent models

### Discussion

*Unplanned exploratory analysis*

### Accounting for effects

# Supplemental Tables and Figures